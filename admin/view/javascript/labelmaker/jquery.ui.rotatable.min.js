(function(e,t){function n(e){r(e,0);var t=e.offset();r(e,e.data("angle"));var n=t.left+e.width()/2;e=t.top+e.height()/2;return[n,e]}function r(e,t){if(t!=0){t=t*(180/Math.PI);t=5*Math.round(t/5)}e.css("transform","rotate("+t+"deg)");e.css("-moz-transform","rotate("+t+"deg)");e.css("-webkit-transform","rotate("+t+"deg)");e.css("-o-transform","rotate("+t+"deg)");e.attr("data-rotate",t)}function i(e){if(u)return!1}function s(e){if(!u)return!1;var t=n(u);e=Math.atan2(e.pageY-t[1],e.pageX-t[0])-a+f;r(u,e);u.data("angle",e);return!1}function o(t){u=e(this).parent();var r=n(u);a=Math.atan2(t.pageY-r[1],t.pageX-r[0]);f=u.data("angle");e(document).on("mousemove",s);return!1}e.widget("ui.rotatable",e.ui.mouse,{options:{handle:!1,angle:0},handle:function(e){if(e===t)return this.options.handle;this.options.handle=e},angle:function(e){if(e===t)return this.options.angle;this.options.angle=e;r(this.element,this.options.angle)},_create:function(){var t;this.options.handle?t=this.options.handle:(t=e(document.createElement("div")),t.addClass("ui-rotatable-handle"));t.draggable({helper:"clone",start:i});t.on("mousedown",o);t.appendTo(this.element);this.element.data("angle",this.options.angle);r(this.element,this.options.angle)}});var u,a,f;e(document).on("mouseup",function(t){if(u)return e(document).unbind("mousemove"),setTimeout(function(){u=!1},10),!1})})(jQuery)