<?php
 class ModelCatalogProductStatus extends Model{public function getStatusDescriptions($a580e85c635bdce66a3425082bbe6275d){$abc70c715f2c65e1ec7c498ba837a2a3f=array();$a466efcb64814880169abf58121918baf=$this->db->query("SELECT * , (SELECT ad.name FROM ".DB_PREFIX."attribute_description ad WHERE ad.attribute_id = s.attribute_id AND ad.language_id = s.language_id) AS attribute_name FROM ".DB_PREFIX."status s WHERE s.status_id = '".(int) $a580e85c635bdce66a3425082bbe6275d."'");foreach($a466efcb64814880169abf58121918baf->rows as $a723618242f48d44ab1e3089c462f38cf){$abc70c715f2c65e1ec7c498ba837a2a3f[$a723618242f48d44ab1e3089c462f38cf['language_id']]=$a723618242f48d44ab1e3089c462f38cf;$abc70c715f2c65e1ec7c498ba837a2a3f[$a723618242f48d44ab1e3089c462f38cf['language_id']]['attribute_value']=$this->getStatusAttributeValues($a723618242f48d44ab1e3089c462f38cf['status_id'],$a723618242f48d44ab1e3089c462f38cf['attribute_id'],$a723618242f48d44ab1e3089c462f38cf['language_id']);}return $abc70c715f2c65e1ec7c498ba837a2a3f;}public function getStatus($a580e85c635bdce66a3425082bbe6275d){$aa12821e3b3169ee3dd2c1a73dc465dc2="SELECT * FROM ".DB_PREFIX."status s WHERE s.language_id = '".(int) $this->config->get('config_language_id')."' AND s.status_id = '".(int) $a580e85c635bdce66a3425082bbe6275d."'";$a466efcb64814880169abf58121918baf=$this->db->query($aa12821e3b3169ee3dd2c1a73dc465dc2);return $a466efcb64814880169abf58121918baf->row;}public function addStatus($a9dc1e53705088e9724b7d25cc98f715d,$a580e85c635bdce66a3425082bbe6275d=0){if(!$a580e85c635bdce66a3425082bbe6275d){$a466efcb64814880169abf58121918baf=$this->db->query("SELECT MAX(status_id) as status_id FROM ".DB_PREFIX."status");if($a466efcb64814880169abf58121918baf->row){$a580e85c635bdce66a3425082bbe6275d=$a466efcb64814880169abf58121918baf->row['status_id'];}else{$a580e85c635bdce66a3425082bbe6275d=0;}$a580e85c635bdce66a3425082bbe6275d++;}foreach($a9dc1e53705088e9724b7d25cc98f715d['status_description']as $aafbc09edb990eecb86c5707f07c501fa=>$a572383266d2b36d60ddb0c84b752c481){$a572383266d2b36d60ddb0c84b752c481['new']=isset($a572383266d2b36d60ddb0c84b752c481['new'])?(int) $a572383266d2b36d60ddb0c84b752c481['new']:0;$a572383266d2b36d60ddb0c84b752c481['bestseller']=isset($a572383266d2b36d60ddb0c84b752c481['bestseller'])?(int) $a572383266d2b36d60ddb0c84b752c481['bestseller']:0;$a572383266d2b36d60ddb0c84b752c481['popular']=isset($a572383266d2b36d60ddb0c84b752c481['popular'])?(int) $a572383266d2b36d60ddb0c84b752c481['popular']:0;$a572383266d2b36d60ddb0c84b752c481['special']=isset($a572383266d2b36d60ddb0c84b752c481['special'])?(int) $a572383266d2b36d60ddb0c84b752c481['special']:0;$a572383266d2b36d60ddb0c84b752c481['promotion']=isset($a572383266d2b36d60ddb0c84b752c481['promotion'])?(int) $a572383266d2b36d60ddb0c84b752c481['promotion']:0;$a572383266d2b36d60ddb0c84b752c481['promotion_image']=isset($a572383266d2b36d60ddb0c84b752c481['promotion_image'])?(int) $a572383266d2b36d60ddb0c84b752c481['promotion_image']:0;$this->db->query("INSERT INTO ".DB_PREFIX."status SET "."`status_id` = '".(int) $a580e85c635bdce66a3425082bbe6275d."', "."`language_id` = '".(int) $aafbc09edb990eecb86c5707f07c501fa."', "."`image` = '".$this->db->escape(html_entity_decode($a572383266d2b36d60ddb0c84b752c481['image'],ENT_QUOTES,'UTF-8'))."', "."`name` = '".$this->db->escape(html_entity_decode($a572383266d2b36d60ddb0c84b752c481['name'],ENT_QUOTES,'UTF-8'))."', "."`attribute_id` = '".(int) $a572383266d2b36d60ddb0c84b752c481['attribute_id']."', "."`sort_order` = '".(int) $a572383266d2b36d60ddb0c84b752c481['sort_order']."', "."`sticker` = '".$this->db->escape(html_entity_decode($a572383266d2b36d60ddb0c84b752c481['sticker'],ENT_QUOTES,'UTF-8'))."', "."`manufacturer_id` = '".(int) $a572383266d2b36d60ddb0c84b752c481['manufacturer_id']."', "."`category_id` = '".(int) $a572383266d2b36d60ddb0c84b752c481['category_id']."', "."`price_from` = '".(float) $a572383266d2b36d60ddb0c84b752c481['price_from']."', "."`price_to` = '".(float) $a572383266d2b36d60ddb0c84b752c481['price_to']."', "."`stock_from` = '".(int) $a572383266d2b36d60ddb0c84b752c481['stock_from']."', "."`stock_to` = '".(int) $a572383266d2b36d60ddb0c84b752c481['stock_to']."', "."`new` = '".(int) $a572383266d2b36d60ddb0c84b752c481['new']."', "."`bestseller` = '".(int) $a572383266d2b36d60ddb0c84b752c481['bestseller']."', "."`popular` = '".(int) $a572383266d2b36d60ddb0c84b752c481['popular']."', "."`special` = '".(int) $a572383266d2b36d60ddb0c84b752c481['special']."', "."`promotion` = '".(int) $a572383266d2b36d60ddb0c84b752c481['promotion']."', "."`promotion_image` = '".(int) $a572383266d2b36d60ddb0c84b752c481['promotion_image']."', "."`url` = '".$this->db->escape(html_entity_decode($a572383266d2b36d60ddb0c84b752c481['url'],ENT_QUOTES,'UTF-8'))."'");$this->editStatusAttributes($a580e85c635bdce66a3425082bbe6275d,$a572383266d2b36d60ddb0c84b752c481['attribute_id'],$aafbc09edb990eecb86c5707f07c501fa,$a572383266d2b36d60ddb0c84b752c481['attribute_value']);}$this->cache->delete('product.statuses');}public function editStatus($a580e85c635bdce66a3425082bbe6275d,$a9dc1e53705088e9724b7d25cc98f715d){$this->db->query("DELETE FROM ".DB_PREFIX."status WHERE status_id = '".(int) $a580e85c635bdce66a3425082bbe6275d."'");$this->addStatus($a9dc1e53705088e9724b7d25cc98f715d,$a580e85c635bdce66a3425082bbe6275d);}public function deleteStatus($a580e85c635bdce66a3425082bbe6275d){$this->db->query("DELETE FROM ".DB_PREFIX."status WHERE status_id = '".(int) $a580e85c635bdce66a3425082bbe6275d."'");$this->db->query("DELETE FROM ".DB_PREFIX."status_attribute WHERE status_id = '".(int) $a580e85c635bdce66a3425082bbe6275d."'");$this->db->query("DELETE FROM ".DB_PREFIX."product_status WHERE status_id = '".(int) $a580e85c635bdce66a3425082bbe6275d."'");$this->cache->delete('product.statuses');}public function getStatuses($a9dc1e53705088e9724b7d25cc98f715d=array()){$aa12821e3b3169ee3dd2c1a73dc465dc2="SELECT * FROM ".DB_PREFIX."status s WHERE s.language_id = '".(int) $this->config->get('config_language_id')."' ";if(!empty($a9dc1e53705088e9724b7d25cc98f715d['filter_name'])){$aa12821e3b3169ee3dd2c1a73dc465dc2.=" AND s.name LIKE '%".$this->db->escape($a9dc1e53705088e9724b7d25cc98f715d['filter_name'])."%'";}$aa12821e3b3169ee3dd2c1a73dc465dc2.=" ORDER BY s.sort_order ASC";if(isset($a9dc1e53705088e9724b7d25cc98f715d['start'])||isset($a9dc1e53705088e9724b7d25cc98f715d['limit'])){if($a9dc1e53705088e9724b7d25cc98f715d['start']<0){$a9dc1e53705088e9724b7d25cc98f715d['start']=0;}if($a9dc1e53705088e9724b7d25cc98f715d['limit']<1){$a9dc1e53705088e9724b7d25cc98f715d['limit']=20;}$aa12821e3b3169ee3dd2c1a73dc465dc2.=" LIMIT ".(int) $a9dc1e53705088e9724b7d25cc98f715d['start'].",".(int) $a9dc1e53705088e9724b7d25cc98f715d['limit'];}$a466efcb64814880169abf58121918baf=$this->db->query($aa12821e3b3169ee3dd2c1a73dc465dc2);return $a466efcb64814880169abf58121918baf->rows;}public function getTotalStatuses(){$a466efcb64814880169abf58121918baf=$this->db->query("SELECT COUNT(*) AS total FROM ".DB_PREFIX."status s WHERE s.language_id = '".(int) $this->config->get('config_language_id')."'");return $a466efcb64814880169abf58121918baf->row['total'];}public function getStatusAttributes($a580e85c635bdce66a3425082bbe6275d,$a6e6ec51d2598185e67830e341e330720,$aafbc09edb990eecb86c5707f07c501fa=0){if(!$aafbc09edb990eecb86c5707f07c501fa){$aafbc09edb990eecb86c5707f07c501fa=(int) $this->config->get('config_language_id');}$aa12821e3b3169ee3dd2c1a73dc465dc2="SELECT * FROM ".DB_PREFIX."status_attribute WHERE language_id = '".(int) $aafbc09edb990eecb86c5707f07c501fa."' AND status_id = '".(int) $a580e85c635bdce66a3425082bbe6275d."' AND attribute_id = '".(int) $a6e6ec51d2598185e67830e341e330720."'";$a466efcb64814880169abf58121918baf=$this->db->query($aa12821e3b3169ee3dd2c1a73dc465dc2);$a7006ad042683e0a3ad382d61be402f9e=array();foreach($a466efcb64814880169abf58121918baf->rows as $abc66ced46876002eb83e1ae8526b1a82){$a7006ad042683e0a3ad382d61be402f9e[]=$abc66ced46876002eb83e1ae8526b1a82['text'];}return $a7006ad042683e0a3ad382d61be402f9e;}public function getStatusAttributeValues($a580e85c635bdce66a3425082bbe6275d,$a6e6ec51d2598185e67830e341e330720,$aafbc09edb990eecb86c5707f07c501fa){$adab6fb8420f563545d8ec2dcff0eafdc=$this->getStatusAttributes($a580e85c635bdce66a3425082bbe6275d,$a6e6ec51d2598185e67830e341e330720,$aafbc09edb990eecb86c5707f07c501fa);return implode(',',$adab6fb8420f563545d8ec2dcff0eafdc);}public function addStatusAttributes($a580e85c635bdce66a3425082bbe6275d,$a6e6ec51d2598185e67830e341e330720,$aafbc09edb990eecb86c5707f07c501fa,$a07916750c931b8bec6e5de2e618ba3b4){if(!is_array($a07916750c931b8bec6e5de2e618ba3b4)){$a07916750c931b8bec6e5de2e618ba3b4=array_map('trim',explode(',',$a07916750c931b8bec6e5de2e618ba3b4));}foreach($a07916750c931b8bec6e5de2e618ba3b4 as $ab4fcb477895ff0c7f5e72e9b204c3a9c){if($a6e6ec51d2598185e67830e341e330720&&$ab4fcb477895ff0c7f5e72e9b204c3a9c){$this->db->query("INSERT INTO ".DB_PREFIX."status_attribute SET "."`status_id` = '".(int) $a580e85c635bdce66a3425082bbe6275d."', "."`language_id` = '".(int) $aafbc09edb990eecb86c5707f07c501fa."', "."`attribute_id` = '".(int) $a6e6ec51d2598185e67830e341e330720."', "."`text` = '".$this->db->escape(html_entity_decode($ab4fcb477895ff0c7f5e72e9b204c3a9c,ENT_QUOTES,'UTF-8'))."'");}}}public function editStatusAttributes($a580e85c635bdce66a3425082bbe6275d,$a6e6ec51d2598185e67830e341e330720,$aafbc09edb990eecb86c5707f07c501fa,$a07916750c931b8bec6e5de2e618ba3b4){$this->db->query("DELETE FROM ".DB_PREFIX."status_attribute WHERE status_id = '".(int) $a580e85c635bdce66a3425082bbe6275d."' AND language_id = '".(int) $aafbc09edb990eecb86c5707f07c501fa."'");$this->addStatusAttributes($a580e85c635bdce66a3425082bbe6275d,$a6e6ec51d2598185e67830e341e330720,$aafbc09edb990eecb86c5707f07c501fa,$a07916750c931b8bec6e5de2e618ba3b4);}public function getProductStatuses($a31aae07a7dab897f954776bb485ffd3f){$aa12821e3b3169ee3dd2c1a73dc465dc2="SELECT s.*, ps.product_show, ps.category_show, ps.product_id, ps.sort_order FROM ".DB_PREFIX."product_status ps LEFT JOIN ".DB_PREFIX."status s ON ps.status_id = s.status_id WHERE s.language_id = '".(int) $this->config->get('config_language_id')."' AND ps.product_id = '".(int) $a31aae07a7dab897f954776bb485ffd3f."' ORDER BY ps.sort_order ASC";$a466efcb64814880169abf58121918baf=$this->db->query($aa12821e3b3169ee3dd2c1a73dc465dc2);$a0ee3689b5c107481f227fc65b9e8a77e=array();foreach($a466efcb64814880169abf58121918baf->rows as $abc66ced46876002eb83e1ae8526b1a82){$abc66ced46876002eb83e1ae8526b1a82['thumb']=$this->getThumb($abc66ced46876002eb83e1ae8526b1a82['image']);$a0ee3689b5c107481f227fc65b9e8a77e[]=$abc66ced46876002eb83e1ae8526b1a82;}return $a0ee3689b5c107481f227fc65b9e8a77e;}public function addProductStatuses($a31aae07a7dab897f954776bb485ffd3f,$a9dc1e53705088e9724b7d25cc98f715d){$this->deleteProductStatuses($a31aae07a7dab897f954776bb485ffd3f);if(isset($a9dc1e53705088e9724b7d25cc98f715d['product_status'])){foreach($a9dc1e53705088e9724b7d25cc98f715d['product_status']as $aa774c7114b2013401619dd9ffcef5095){if($aa774c7114b2013401619dd9ffcef5095['status_id']){$a580e85c635bdce66a3425082bbe6275d=$aa774c7114b2013401619dd9ffcef5095['status_id'];$aa5de09c4efc95bf3095553c91f6991da=isset($aa774c7114b2013401619dd9ffcef5095['product_show'])?$aa774c7114b2013401619dd9ffcef5095['product_show']:0;$a7c99444888a3da9fa97e6f6a504e294a=isset($aa774c7114b2013401619dd9ffcef5095['category_show'])?$aa774c7114b2013401619dd9ffcef5095['category_show']:0;$a49c9a8bf0b09847100cf3f6cdc90b512=isset($aa774c7114b2013401619dd9ffcef5095['sort_order'])?$aa774c7114b2013401619dd9ffcef5095['sort_order']:0;$this->db->query("INSERT INTO ".DB_PREFIX."product_status SET status_id = '".(int) $a580e85c635bdce66a3425082bbe6275d."', product_id = '".(int) $a31aae07a7dab897f954776bb485ffd3f."', product_show = '".(int) $aa5de09c4efc95bf3095553c91f6991da."', category_show = '".(int) $a7c99444888a3da9fa97e6f6a504e294a."', sort_order = '".(int) $a49c9a8bf0b09847100cf3f6cdc90b512."'");}}}}public function deleteProductStatuses($a31aae07a7dab897f954776bb485ffd3f){$this->db->query("DELETE FROM ".DB_PREFIX."product_status WHERE product_id = '".(int) $a31aae07a7dab897f954776bb485ffd3f."'");$this->cache->delete('product.statuses');}public function getThumb($a763d8213d1e5b3f601b48cef4094d997,$ad8325d44ceb81caa320cbad6d4dd63b2='product'){$this->load->model('tool/image');$ad8acf574e00cc8fa93a0931cd71831be=$this->config->get('product_status_options');$a4d40a348d62565cc528d44ca17bd08e2=HTTP_CATALOG.'image/'.$a763d8213d1e5b3f601b48cef4094d997;if(!isset($a763d8213d1e5b3f601b48cef4094d997)||!$a763d8213d1e5b3f601b48cef4094d997||!file_exists(DIR_IMAGE.$a763d8213d1e5b3f601b48cef4094d997)){$a763d8213d1e5b3f601b48cef4094d997='no_image.jpg';}if($ad8acf574e00cc8fa93a0931cd71831be[$ad8325d44ceb81caa320cbad6d4dd63b2]['image_width']||$ad8acf574e00cc8fa93a0931cd71831be[$ad8325d44ceb81caa320cbad6d4dd63b2]['image_height']){$a4d40a348d62565cc528d44ca17bd08e2=$this->model_tool_image->resize($a763d8213d1e5b3f601b48cef4094d997,$ad8acf574e00cc8fa93a0931cd71831be[$ad8325d44ceb81caa320cbad6d4dd63b2]['image_width'],$ad8acf574e00cc8fa93a0931cd71831be[$ad8325d44ceb81caa320cbad6d4dd63b2]['image_height']);}return $a4d40a348d62565cc528d44ca17bd08e2;}public function getDefaultOptions(){return array('key'=>'3fa0338f0511a2197b4659f2d2e3c878','product'=>array('image_width'=>50,'image_height'=>50,'name_display'=>'tip','status_display'=>'inline','auto_display'=>'enable','sticker_display'=>'enable'),'category'=>array('image_width'=>50,'image_height'=>50,'name_display'=>'tip','status_display'=>'inline','auto_display'=>'enable','sticker_display'=>'enable'),'product_sticker'=>array('image_width'=>50,'image_height'=>50,),'category_sticker'=>array('image_width'=>50,'image_height'=>50,),'status_bestseller_total'=>5,'status_popular_total'=>50,'status_new_hours'=>72,'cache'=>0);}public function install(){$this->uninstall();$this->db->query("
			CREATE TABLE IF NOT EXISTS ".DB_PREFIX."status (
				`status_id` int(11) NOT NULL,
				`language_id` int(11) NOT NULL,
				`image` varchar(255) NOT NULL,
				`name` text NOT NULL,
				`url` varchar(255) NOT NULL,
				`sort_order` INT(3) NOT NULL DEFAULT '0',
				`attribute_id` int(11) NOT NULL,
				`sticker` VARCHAR(255) NOT NULL,
				`manufacturer_id` INT(11) NOT NULL, 
				`category_id` INT(11) NOT NULL,
				`price_from` DECIMAL(15,4) NOT NULL,
				`price_to` DECIMAL(15,4) NOT NULL,
				`stock_from` INT(4) NOT NULL,
				`stock_to` INT(4) NOT NULL,
				`new` INT(1) NOT NULL,
				`bestseller` INT(1) NOT NULL,
				`popular` INT(1) NOT NULL,
				`special` INT(1) NOT NULL,
				`promotion` INT(1) NOT NULL,
				`promotion_image` INT(1) NOT NULL, 
				PRIMARY KEY (`status_id`, `language_id`)
			) ENGINE=MyISAM DEFAULT CHARSET=utf8  COLLATE=utf8_general_ci
		");$this->db->query("
			CREATE TABLE IF NOT EXISTS ".DB_PREFIX."status_attribute (
				`status_id` int(11) NOT NULL,
				`attribute_id` int(11) NOT NULL,
				`language_id` int(11) NOT NULL,
				`text` text NOT NULL,
				KEY (`status_id`, `attribute_id`, `language_id`)
			) ENGINE=MyISAM DEFAULT CHARSET=utf8  COLLATE=utf8_general_ci
		");$this->db->query("
			CREATE TABLE  IF NOT EXISTS ".DB_PREFIX."product_status (
				`product_id` int(11) NOT NULL,
				`status_id` int(11) NOT NULL,
				`product_show` int(1) NOT NULL,
				`category_show` tinyint(1) NOT NULL,
				`sort_order` INT(3) NOT NULL DEFAULT '0',
				KEY (`status_id`),
				KEY (`product_id`)
			) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci
		");}public function uninstall(){$this->db->query("DROP TABLE IF EXISTS ".DB_PREFIX."status");$this->db->query("DROP TABLE IF EXISTS ".DB_PREFIX."status_attribute");$this->db->query("DROP TABLE IF EXISTS ".DB_PREFIX."product_status");}}
//author sv2109 (sv2109@gmail.com) license for 1 product copy granted for Blackangel861 ( filosofia-buduara.ru)
